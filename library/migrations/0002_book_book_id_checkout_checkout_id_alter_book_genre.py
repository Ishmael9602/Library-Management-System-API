# Generated by Django 5.2.4 on 2025-08-29 16:57

import uuid
from django.db import migrations, models


def generate_uuids(apps, schema_editor):
    Book = apps.get_model('library', 'Book')
    for book in Book.objects.all():
        book.book_id = uuid.uuid4()
        book.save()

    Checkout = apps.get_model('library', 'Checkout')
    for checkout in Checkout.objects.all():
        checkout.checkout_id = uuid.uuid4()
        checkout.save()


class Migration(migrations.Migration):

    dependencies = [
        ('library', '0001_initial'),
    ]

    operations = [
        migrations.AddField(
            model_name='book',
            name='book_id',
            field=models.UUIDField(default=uuid.uuid4, editable=False),
        ),
        migrations.AddField(
            model_name='checkout',
            name='checkout_id',
            field=models.UUIDField(default=uuid.uuid4, editable=False),
        ),
        # Step 2: Populate existing rows
        migrations.RunPython(generate_uuids),
        # Step 3: Alter fields to add unique constraint
        migrations.AlterField(
            model_name='book',
            name='book_id',
            field=models.UUIDField(default=uuid.uuid4, editable=False, unique=True),
        ),
        migrations.AlterField(
            model_name='checkout',
            name='checkout_id',
            field=models.UUIDField(default=uuid.uuid4, editable=False, unique=True),
        ),
        # Step 4: Alter genre as before
        migrations.AlterField(
            model_name='book',
            name='genre',
            field=models.CharField(
                blank=True,
                choices=[
                    ('Fiction', 'Fiction'),
                    ('Non-Fiction', 'Non-Fiction'),
                    ('Mystery', 'Mystery'),
                    ('Science Fiction', 'Science Fiction'),
                    ('Fantasy', 'Fantasy'),
                    ('Romance', 'Romance'),
                    ('Thriller', 'Thriller'),
                    ('Biography', 'Biography'),
                    ('History', 'History'),
                    ('Science', 'Science')
                ],
                help_text='Book genre',
                max_length=50
            ),
        ),
    ]
